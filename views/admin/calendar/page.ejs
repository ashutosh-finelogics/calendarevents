<div class="content_body">
  <div class="row mb-3">
    <div class="col-12">
      <h4>Calendar - Configured Users</h4>
      <p class="text-muted small">
        Users are read from <code>config/users.xml</code>.
        Time slots (start, end, duration) are read from <code>config/slot-config.xml</code>.
      </p>
      <% if (message) { %><div class="alert alert-info"><%= message %></div><% } %>
    </div>
  </div>
  <div class="row mb-3">
    <div class="col-md-4">
      <label for="dateSelect">Date</label>
      <input type="text" id="dateSelect" class="form-control" placeholder="YYYY-MM-DD" readonly>
    </div>
    <div class="col-md-4 d-flex align-items-end">
      <button type="button" class="btn btn-outline-secondary mr-1" id="prevDayBtn">← Previous day</button>
      <button type="button" class="btn btn-outline-secondary" id="nextDayBtn">Next day →</button>
    </div>
    <div class="col-md-4 d-none d-md-flex align-items-end justify-content-md-end mt-3 mt-md-0">
      <div class="btn-group btn-group-sm" role="group" aria-label="View toggle">
        <button type="button" class="btn btn-primary" id="viewSlotsBtn">Time slots</button>
        <button type="button" class="btn btn-outline-secondary" id="viewSummaryBtn">Busy / free</button>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-12">
      <div id="eventsPlaceholder" class="text-muted py-4">Select a date to load events for all configured users.</div>
      <div id="eventsLoading" class="py-5 text-center" style="display:none;">
        <div class="spinner-border text-primary" role="status"><span class="sr-only">Loading...</span></div>
        <p class="mt-2 text-muted mb-0">Loading events…</p>
      </div>
      <div id="eventsError" class="alert alert-danger" style="display:none;"></div>
      <div id="eventsContainer" style="display:none;">
        <h5 class="mb-2">Events for <span id="eventsDateLabel"></span></h5>

        <!-- Mobile-first accordion list (shown on small screens) -->
        <div class="d-block d-md-none" id="mobileListContainer" style="max-height: 70vh; overflow-y: auto; -webkit-overflow-scrolling: touch;">
          <div id="mobileList"></div>
        </div>

        <!-- Desktop views: slot grid and busy/free summary -->
        <div class="d-none d-md-block">
          <div class="calendar-table-scroll border rounded p-2" id="slotView" style="max-height: 70vh; overflow: auto; -webkit-overflow-scrolling: touch;">
          <script>
            window.CALENDAR_TIME_SLOTS = <%- slotConfigJson %>;
          </script>
          <table class="table table-bordered table-sm mb-0 calendar-slot-table" style="min-width:<%= 530 + (slotConfig ? slotConfig.length * 140 : 0) %>px;">
            <thead class="thead-light">
              <tr>
                <th class="calendar-col-sr">Sr. No</th>
                <th class="calendar-col-name">Employee Name</th>
                <th class="calendar-col-email">Email</th>
                <% (slotConfig || []).forEach(function(slot) { %>
                  <th class="calendar-col-slot"><%= slot.label %></th>
                <% }); %>
              </tr>
            </thead>
            <tbody id="eventsTableBody">
            </tbody>
          </table>
          </div>
          <div class="calendar-table-scroll border rounded p-2" id="summaryView" style="max-height: 70vh; overflow: auto; -webkit-overflow-scrolling: touch; display: none;">
            <table class="table table-bordered table-sm mb-0 calendar-slot-table">
              <thead class="thead-light">
                <tr>
                  <th class="calendar-col-sr">Sr. No</th>
                  <th class="calendar-col-name">Employee Name</th>
                  <th class="calendar-col-email">Email</th>
                  <th style="min-width: 260px;">Busy events</th>
                  <th style="min-width: 260px;">Free slots</th>
                </tr>
              </thead>
              <tbody id="summaryTableBody">
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<style>
.calendar-table-scroll { overflow-x: auto; overflow-y: auto; -webkit-overflow-scrolling: touch; }
.calendar-slot-table { table-layout: fixed; }
.calendar-slot-table .calendar-col-sr { width: 70px; min-width: 70px; position: sticky; left: 0; z-index: 3; background: #f8f9fa; box-shadow: 2px 0 4px rgba(0,0,0,0.05); }
.calendar-slot-table .calendar-col-name { width: 200px; min-width: 200px; position: sticky; left: 70px; z-index: 3; background: #f8f9fa; box-shadow: 2px 0 4px rgba(0,0,0,0.05); }
.calendar-slot-table .calendar-col-email { width: 260px; min-width: 260px; position: sticky; left: 270px; z-index: 3; background: #f8f9fa; box-shadow: 2px 0 4px rgba(0,0,0,0.05); }
.calendar-slot-table .calendar-col-slot { width: 140px; min-width: 140px; }
.calendar-slot-table thead th { position: sticky; top: 0; z-index: 2; background: #f8f9fa !important; }
.calendar-slot-table thead .calendar-col-sr,
.calendar-slot-table thead .calendar-col-name,
.calendar-slot-table thead .calendar-col-email { top: 0; z-index: 4; }
.calendar-slot-table tbody .calendar-col-sr { position: sticky; left: 0; z-index: 1; background: #fff; box-shadow: 2px 0 4px rgba(0,0,0,0.05); }
.calendar-slot-table tbody .calendar-col-name { position: sticky; left: 70px; z-index: 1; background: #fff; box-shadow: 2px 0 4px rgba(0,0,0,0.05); }
.calendar-slot-table tbody .calendar-col-email { position: sticky; left: 270px; z-index: 1; background: #fff; box-shadow: 2px 0 4px rgba(0,0,0,0.05); }
</style>
